{"version":"1.1","parameters":{"Bucket":{"required":false,"type":"String"},"Region":{"builtIn":"AWS::Region","required":false,"type":"String"},"UseFIPS":{"builtIn":"AWS::UseFIPS","required":true,"default":false,"type":"Boolean"},"UseDualStack":{"builtIn":"AWS::UseDualStack","required":true,"default":false,"type":"Boolean"},"Endpoint":{"builtIn":"SDK::Endpoint","required":false,"type":"String"},"ForcePathStyle":{"builtIn":"AWS::S3::ForcePathStyle","required":false,"type":"Boolean"},"Accelerate":{"builtIn":"AWS::S3::Accelerate","required":true,"default":false,"type":"Boolean"},"SnowEndpointUrl":{"required":false,"type":"String"},"DisableAccessPoints":{"required":false,"type":"Boolean"},"DisableMRAP":{"required":false,"type":"Boolean"},"UseArnRegion":{"builtIn":"AWS::S3::UseArnRegion","required":false,"type":"Boolean"}},"rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"isSet","argv":[{"ref":"Region"}]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"stringEquals","argv":[{"ref":"Region"},"snow"]}],"type":"tree","rules":[{"conditions":[{"fn":"isSet","argv":[{"ref":"SnowEndpointUrl"}]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]}],"error":"S3 Snow does not support Dual-stack","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},true]}],"error":"S3 Snow does not support FIPS","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"Accelerate"},true]}],"error":"S3 Snow does not support S3 Accelerate","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"parseURL","argv":[{"ref":"SnowEndpointUrl"}],"assign":"snowUrl"}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"isSet","argv":[{"ref":"Bucket"}]}],"endpoint":{"url":"{snowUrl#scheme}://{snowUrl#authority}/{Bucket}","properties":{"authSchemes":[{"signingName":"s3-snow","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Bucket"}]}]}],"endpoint":{"url":"{snowUrl#scheme}://{snowUrl#authority}","properties":{"authSchemes":[{"signingName":"s3-snow","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"}]}]},{"conditions":[],"error":"Snow endpoint url was not a valid url","type":"error"}]}]}]}]}]},{"conditions":[],"error":"Expected snow endpoint url to be set but no url was found","type":"error"}]},{"conditions":[{"fn":"isSet","argv":[{"ref":"Bucket"}]}],"type":"tree","rules":[{"conditions":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]},{"fn":"not","argv":[{"fn":"isSet","argv":[{"fn":"parseURL","argv":[{"ref":"Endpoint"}]}]}]}],"error":"Custom endpoint `{Endpoint}` was not a valid URI","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"substring","argv":[{"ref":"Bucket"},49,50,true],"assign":"hardwareType"},{"fn":"substring","argv":[{"ref":"Bucket"},8,12,true],"assign":"regionPrefix"},{"fn":"substring","argv":[{"ref":"Bucket"},0,7,true],"assign":"abbaSuffix"},{"fn":"substring","argv":[{"ref":"Bucket"},32,49,true],"assign":"outpostId"},{"fn":"aws.partition","argv":[{"ref":"Region"}],"assign":"regionPartition"},{"fn":"stringEquals","argv":[{"ref":"abbaSuffix"},"--op-s3"]}],"type":"tree","rules":[{"conditions":[{"fn":"isValidHostLabel","argv":[{"ref":"outpostId"},false]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"stringEquals","argv":[{"ref":"hardwareType"},"e"]}],"type":"tree","rules":[{"conditions":[{"fn":"stringEquals","argv":[{"ref":"regionPrefix"},"beta"]}],"type":"tree","rules":[{"conditions":[{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]}]}],"error":"Expected a endpoint to be specified but no endpoint was found","type":"error"},{"conditions":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]},{"fn":"parseURL","argv":[{"ref":"Endpoint"}],"assign":"url"}],"endpoint":{"url":"https://{Bucket}.ec2.{url#authority}","properties":{"authSchemes":[{"signingName":"s3-outposts","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"}]},{"conditions":[],"endpoint":{"url":"https://{Bucket}.ec2.s3-outposts.{Region}.{regionPartition#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3-outposts","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"}]},{"conditions":[{"fn":"stringEquals","argv":[{"ref":"hardwareType"},"o"]}],"type":"tree","rules":[{"conditions":[{"fn":"stringEquals","argv":[{"ref":"regionPrefix"},"beta"]}],"type":"tree","rules":[{"conditions":[{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]}]}],"error":"Expected a endpoint to be specified but no endpoint was found","type":"error"},{"conditions":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]},{"fn":"parseURL","argv":[{"ref":"Endpoint"}],"assign":"url"}],"endpoint":{"url":"https://{Bucket}.op-{outpostId}.{url#authority}","properties":{"authSchemes":[{"signingName":"s3-outposts","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"}]},{"conditions":[],"endpoint":{"url":"https://{Bucket}.op-{outpostId}.s3-outposts.{Region}.{regionPartition#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3-outposts","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"}]},{"conditions":[],"error":"Unrecognized hardware type: \"Expected hardware type o or e but got {hardwareType}\"","type":"error"}]}]},{"conditions":[],"error":"Invalid ARN: The outpost Id must only contain a-z, A-Z, 0-9 and `-`.","type":"error"}]},{"conditions":[{"fn":"isSet","argv":[{"ref":"ForcePathStyle"}]},{"fn":"booleanEquals","argv":[{"ref":"ForcePathStyle"},true]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"aws.parseArn","argv":[{"ref":"Bucket"}]}],"error":"Path-style addressing cannot be used with ARN buckets","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]},{"fn":"isSet","argv":[{"ref":"Endpoint"}]}],"error":"Cannot set dual-stack in combination with a custom endpoint.","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"aws.partition","argv":[{"ref":"Region"}],"assign":"partitionResult"}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"Accelerate"},false]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},false]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]},{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]}]}],"endpoint":{"url":"https://s3.dualstack.{Region}.{partitionResult#dnsSuffix}/{Bucket}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},false]},{"fn":"isSet","argv":[{"ref":"Endpoint"}]},{"fn":"parseURL","argv":[{"ref":"Endpoint"}],"assign":"url"}],"endpoint":{"url":"{url#scheme}://{url#authority}{url#normalizedPath}{Bucket}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},false]},{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]}]}],"endpoint":{"url":"https://s3.{Region}.{partitionResult#dnsSuffix}/{Bucket}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"}]}]},{"conditions":[],"error":"Path-style addressing cannot be used with FIPS","type":"error"}]}]},{"conditions":[],"error":"Path-style addressing cannot be used with S3 Accelerate","type":"error"}]}]},{"conditions":[],"error":"A valid partition could not be determined","type":"error"}]}]}]}]},{"conditions":[{"fn":"isValidHostLabel","argv":[{"ref":"Bucket"},true]}],"type":"tree","rules":[{"conditions":[{"fn":"aws.partition","argv":[{"ref":"Region"}],"assign":"partitionResult"}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"isValidHostLabel","argv":[{"ref":"Region"},false]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},true]},{"fn":"stringEquals","argv":[{"fn":"getAttr","argv":[{"ref":"partitionResult"},"name"]},"aws-cn"]}],"error":"Partition does not support FIPS","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"Accelerate"},true]},{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},true]}],"error":"Accelerate cannot be used with FIPS","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"Accelerate"},true]},{"fn":"stringEquals","argv":[{"fn":"getAttr","argv":[{"ref":"partitionResult"},"name"]},"aws-cn"]}],"error":"S3 Accelerate cannot be used in this region","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]},{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]}],"error":"Host override cannot be combined with Dualstack, FIPS, or S3 Accelerate","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]},{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},true]}],"error":"Host override cannot be combined with Dualstack, FIPS, or S3 Accelerate","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]},{"fn":"booleanEquals","argv":[{"ref":"Accelerate"},true]}],"error":"Host override cannot be combined with Dualstack, FIPS, or S3 Accelerate","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]},{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},true]},{"fn":"booleanEquals","argv":[{"ref":"Accelerate"},false]},{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]}]}],"endpoint":{"url":"https://{Bucket}.s3-fips.dualstack.{Region}.{partitionResult#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},false]},{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},true]},{"fn":"booleanEquals","argv":[{"ref":"Accelerate"},false]},{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]}]}],"endpoint":{"url":"https://{Bucket}.s3-fips.{Region}.{partitionResult#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]},{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},false]},{"fn":"booleanEquals","argv":[{"ref":"Accelerate"},true]},{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]}]}],"endpoint":{"url":"https://{Bucket}.s3-accelerate.dualstack.{partitionResult#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]},{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},false]},{"fn":"booleanEquals","argv":[{"ref":"Accelerate"},false]},{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]}]}],"endpoint":{"url":"https://{Bucket}.s3.dualstack.{Region}.{partitionResult#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},false]},{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},false]},{"fn":"booleanEquals","argv":[{"ref":"Accelerate"},false]},{"fn":"isSet","argv":[{"ref":"Endpoint"}]},{"fn":"parseURL","argv":[{"ref":"Endpoint"}],"assign":"url"},{"fn":"booleanEquals","argv":[{"fn":"getAttr","argv":[{"ref":"url"},"isIp"]},true]}],"endpoint":{"url":"{url#scheme}://{url#authority}{url#normalizedPath}{Bucket}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},false]},{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},false]},{"fn":"booleanEquals","argv":[{"ref":"Accelerate"},false]},{"fn":"isSet","argv":[{"ref":"Endpoint"}]},{"fn":"parseURL","argv":[{"ref":"Endpoint"}],"assign":"url"},{"fn":"booleanEquals","argv":[{"fn":"getAttr","argv":[{"ref":"url"},"isIp"]},false]}],"endpoint":{"url":"{url#scheme}://{Bucket}.{url#authority}{url#path}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},false]},{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},false]},{"fn":"booleanEquals","argv":[{"ref":"Accelerate"},true]},{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]}]}],"endpoint":{"url":"https://{Bucket}.s3-accelerate.{partitionResult#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},false]},{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},false]},{"fn":"booleanEquals","argv":[{"ref":"Accelerate"},false]},{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]}]}],"endpoint":{"url":"https://{Bucket}.s3.{Region}.{partitionResult#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"}]}]}]}]}]}]}]}]},{"conditions":[],"error":"Region was not a valid host label","type":"error"}]}]},{"conditions":[],"error":"A valid partition could not be determined","type":"error"}]},{"conditions":[{"fn":"aws.parseArn","argv":[{"ref":"Bucket"}],"assign":"bucketArn"}],"type":"tree","rules":[{"conditions":[{"fn":"getAttr","argv":[{"ref":"bucketArn"},"resourceId[0]"],"assign":"arnType"},{"fn":"not","argv":[{"fn":"stringEquals","argv":[{"ref":"arnType"},""]}]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"stringEquals","argv":[{"ref":"arnType"},"accesspoint"]}],"type":"tree","rules":[{"conditions":[{"fn":"getAttr","argv":[{"ref":"bucketArn"},"resourceId[1]"],"assign":"accessPointName"},{"fn":"not","argv":[{"fn":"stringEquals","argv":[{"ref":"accessPointName"},""]}]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"not","argv":[{"fn":"stringEquals","argv":[{"fn":"getAttr","argv":[{"ref":"bucketArn"},"region"]},""]}]}],"type":"tree","rules":[{"conditions":[{"fn":"stringEquals","argv":[{"ref":"arnType"},"accesspoint"]}],"type":"tree","rules":[{"conditions":[{"fn":"not","argv":[{"fn":"stringEquals","argv":[{"fn":"getAttr","argv":[{"ref":"bucketArn"},"region"]},""]}]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"isSet","argv":[{"ref":"DisableAccessPoints"}]},{"fn":"booleanEquals","argv":[{"ref":"DisableAccessPoints"},true]}],"error":"Access points are not supported for this operation","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"not","argv":[{"fn":"isSet","argv":[{"fn":"getAttr","argv":[{"ref":"bucketArn"},"resourceId[2]"]}]}]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"isSet","argv":[{"ref":"UseArnRegion"}]},{"fn":"booleanEquals","argv":[{"ref":"UseArnRegion"},false]},{"fn":"not","argv":[{"fn":"stringEquals","argv":[{"fn":"getAttr","argv":[{"ref":"bucketArn"},"region"]},"{Region}"]}]}],"error":"Invalid configuration: region from ARN `{bucketArn#region}` does not match client region `{Region}` and UseArnRegion is `false`","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"aws.partition","argv":[{"fn":"getAttr","argv":[{"ref":"bucketArn"},"region"]}],"assign":"bucketPartition"}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"stringEquals","argv":[{"fn":"getAttr","argv":[{"ref":"bucketArn"},"service"]},"s3"]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"isValidHostLabel","argv":[{"fn":"getAttr","argv":[{"ref":"bucketArn"},"accountId"]},false]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"isValidHostLabel","argv":[{"ref":"accessPointName"},false]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"Accelerate"},true]}],"error":"Access Points do not support S3 Accelerate","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},true]},{"fn":"stringEquals","argv":[{"fn":"getAttr","argv":[{"ref":"bucketPartition"},"name"]},"aws-cn"]}],"error":"Partition does not support FIPS","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]},{"fn":"isSet","argv":[{"ref":"Endpoint"}]}],"error":"DualStack cannot be combined with a Host override (PrivateLink)","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},true]},{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]}],"endpoint":{"url":"https://{accessPointName}-{bucketArn#accountId}.s3-accesspoint-fips.dualstack.{bucketArn#region}.{bucketPartition#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{bucketArn#region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},true]},{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},false]}],"endpoint":{"url":"https://{accessPointName}-{bucketArn#accountId}.s3-accesspoint-fips.{bucketArn#region}.{bucketPartition#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{bucketArn#region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},false]},{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]}],"endpoint":{"url":"https://{accessPointName}-{bucketArn#accountId}.s3-accesspoint.dualstack.{bucketArn#region}.{bucketPartition#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{bucketArn#region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},false]},{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},false]},{"fn":"isSet","argv":[{"ref":"Endpoint"}]},{"fn":"parseURL","argv":[{"ref":"Endpoint"}],"assign":"url"}],"endpoint":{"url":"https://{accessPointName}-{bucketArn#accountId}.{url#authority}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{bucketArn#region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},false]},{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},false]}],"endpoint":{"url":"https://{accessPointName}-{bucketArn#accountId}.s3-accesspoint.{bucketArn#region}.{bucketPartition#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{bucketArn#region}"}]},"headers":{}},"type":"endpoint"}]}]}]}]}]},{"conditions":[],"error":"Invalid ARN: The access point name may only contain a-z, A-Z, 0-9 and `-`. Found: {accessPointName}","type":"error"}]}]},{"conditions":[],"error":"Invalid ARN: The account id may only contain a-z, A-Z, 0-9 and `-`. Found: {bucketArn#accountId}","type":"error"}]}]},{"conditions":[],"error":"Invalid ARN: The ARN was not for the S3 service, found: {bucketArn#service}","type":"error"}]}]},{"conditions":[],"error":"Could not load partition for ARN region `{bucketArn#region}`","type":"error"}]}]}]},{"conditions":[],"error":"Invalid ARN: The ARN may only contain a single resource component after `accesspoint`.","type":"error"}]}]}]},{"conditions":[],"error":"Invalid ARN: bucket ARN is missing a region","type":"error"}]}]},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"isValidHostLabel","argv":[{"ref":"accessPointName"},true]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]}],"error":"S3 MRAP does not support dual-stack","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},true]}],"error":"S3 MRAP does not support FIPS","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"Accelerate"},true]}],"error":"S3 MRAP does not support S3 Accelerate","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"isSet","argv":[{"ref":"DisableMRAP"}]},{"fn":"booleanEquals","argv":[{"ref":"DisableMRAP"},true]}],"error":"Invalid configuration: Multi-Region Access Point ARNs are disabled.","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"aws.partition","argv":[{"ref":"Region"}],"assign":"mrapPartition"}],"type":"tree","rules":[{"conditions":[],"endpoint":{"url":"https://{accessPointName}.accesspoint.s3-global.{mrapPartition#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4a","signingRegionSet":["*"]}]},"headers":{}},"type":"endpoint"}]},{"conditions":[],"error":"{Region} was not a valid region","type":"error"}]}]}]}]}]}]},{"conditions":[],"error":"Invalid Access Point Name","type":"error"}]}]}]},{"conditions":[],"error":"Invalid ARN: Expected a resource of the format `accesspoint:<accesspoint name>` but no name was provided","type":"error"}]},{"conditions":[{"fn":"stringEquals","argv":[{"fn":"getAttr","argv":[{"ref":"bucketArn"},"service"]},"s3-outposts"]}],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]}],"error":"S3 Outposts does not support Dual-stack","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},true]}],"error":"S3 Outposts does not support FIPS","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"Accelerate"},true]}],"error":"S3 Outposts does not support S3 Accelerate","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"getAttr","argv":[{"ref":"bucketArn"},"resourceId[1]"],"assign":"outpostId"}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"isValidHostLabel","argv":[{"ref":"outpostId"},false]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"isSet","argv":[{"ref":"UseArnRegion"}]},{"fn":"booleanEquals","argv":[{"ref":"UseArnRegion"},false]},{"fn":"not","argv":[{"fn":"stringEquals","argv":[{"fn":"getAttr","argv":[{"ref":"bucketArn"},"region"]},"{Region}"]}]}],"error":"Invalid configuration: region from ARN `{bucketArn#region}` does not match client region `{Region}` and UseArnRegion is `false`","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"aws.partition","argv":[{"fn":"getAttr","argv":[{"ref":"bucketArn"},"region"]}],"assign":"bucketPartition"}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"isValidHostLabel","argv":[{"fn":"getAttr","argv":[{"ref":"bucketArn"},"accountId"]},false]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"getAttr","argv":[{"ref":"bucketArn"},"resourceId[2]"],"assign":"outpostType"}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"getAttr","argv":[{"ref":"bucketArn"},"resourceId[3]"],"assign":"accessPointName"}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"stringEquals","argv":[{"ref":"outpostType"},"accesspoint"]}],"type":"tree","rules":[{"conditions":[],"endpoint":{"url":"https://{accessPointName}-{bucketArn#accountId}.{outpostId}.s3-outposts.{bucketArn#region}.{bucketPartition#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3-outposts","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{bucketArn#region}"}]},"headers":{}},"type":"endpoint"}]},{"conditions":[],"error":"Expected an outpost type `accesspoint`, found {outpostType}","type":"error"}]}]},{"conditions":[],"error":"Invalid ARN: expected an access point name","type":"error"}]}]},{"conditions":[],"error":"Invalid ARN: Expected a 4-component resource","type":"error"}]}]},{"conditions":[],"error":"Invalid ARN: The account id may only contain a-z, A-Z, 0-9 and `-`. Found: {bucketArn#accountId}","type":"error"}]}]},{"conditions":[],"error":"Could not load partition for ARN region {bucketArn#region}","type":"error"}]}]}]},{"conditions":[],"error":"Invalid ARN: The outpost Id must only contain a-z, A-Z, 0-9 and `-`.","type":"error"}]}]},{"conditions":[],"error":"Invalid ARN: The Outpost Id was not set","type":"error"}]}]}]}]},{"conditions":[],"error":"Invalid ARN: Unrecognized format: {Bucket} (type: {arnType})","type":"error"}]}]},{"conditions":[],"error":"Invalid ARN: No ARN type specified","type":"error"}]},{"conditions":[{"fn":"substring","argv":[{"ref":"Bucket"},0,4,false],"assign":"arnPrefix"},{"fn":"stringEquals","argv":[{"ref":"arnPrefix"},"arn:"]},{"fn":"not","argv":[{"fn":"isSet","argv":[{"fn":"aws.parseArn","argv":[{"ref":"Bucket"}]}]}]}],"error":"Invalid ARN: `{Bucket}` was not a valid ARN","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]},{"fn":"isSet","argv":[{"ref":"Endpoint"}]}],"error":"Cannot set dual-stack in combination with a custom endpoint.","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"aws.partition","argv":[{"ref":"Region"}],"assign":"partitionResult"}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"Accelerate"},false]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},false]}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]},{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]}]}],"endpoint":{"url":"https://s3.dualstack.{Region}.{partitionResult#dnsSuffix}/{Bucket}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},false]},{"fn":"isSet","argv":[{"ref":"Endpoint"}]},{"fn":"parseURL","argv":[{"ref":"Endpoint"}],"assign":"url"}],"endpoint":{"url":"{url#scheme}://{url#authority}{url#normalizedPath}{Bucket}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},false]},{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]}]}],"endpoint":{"url":"https://s3.{Region}.{partitionResult#dnsSuffix}/{Bucket}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"}]}]},{"conditions":[],"error":"Path-style addressing cannot be used with FIPS","type":"error"}]}]},{"conditions":[],"error":"Path-style addressing cannot be used with S3 Accelerate","type":"error"}]}]},{"conditions":[],"error":"A valid partition could not be determined","type":"error"}]}]}]}]},{"conditions":[{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Bucket"}]}]}],"type":"tree","rules":[{"conditions":[{"fn":"aws.partition","argv":[{"ref":"Region"}],"assign":"partitionResult"}],"type":"tree","rules":[{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},true]},{"fn":"stringEquals","argv":[{"fn":"getAttr","argv":[{"ref":"partitionResult"},"name"]},"aws-cn"]}],"error":"Partition does not support FIPS","type":"error"},{"conditions":[],"type":"tree","rules":[{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},true]},{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]},{"fn":"isSet","argv":[{"ref":"Endpoint"}]},{"fn":"parseURL","argv":[{"ref":"Endpoint"}],"assign":"url"}],"endpoint":{"url":"{url#scheme}://{url#authority}{url#path}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},true]},{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]},{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]}]}],"endpoint":{"url":"https://s3-fips.dualstack.{Region}.{partitionResult#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},true]},{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},false]},{"fn":"isSet","argv":[{"ref":"Endpoint"}]},{"fn":"parseURL","argv":[{"ref":"Endpoint"}],"assign":"url"}],"endpoint":{"url":"{url#scheme}://{url#authority}{url#path}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},true]},{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},false]},{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]}]}],"endpoint":{"url":"https://s3-fips.{Region}.{partitionResult#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},false]},{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]},{"fn":"isSet","argv":[{"ref":"Endpoint"}]},{"fn":"parseURL","argv":[{"ref":"Endpoint"}],"assign":"url"}],"endpoint":{"url":"{url#scheme}://{url#authority}{url#path}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},false]},{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},true]},{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]}]}],"endpoint":{"url":"https://s3.dualstack.{Region}.{partitionResult#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},false]},{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},false]},{"fn":"isSet","argv":[{"ref":"Endpoint"}]},{"fn":"parseURL","argv":[{"ref":"Endpoint"}],"assign":"url"}],"endpoint":{"url":"{url#scheme}://{url#authority}{url#path}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"},{"conditions":[{"fn":"booleanEquals","argv":[{"ref":"UseFIPS"},false]},{"fn":"booleanEquals","argv":[{"ref":"UseDualStack"},false]},{"fn":"not","argv":[{"fn":"isSet","argv":[{"ref":"Endpoint"}]}]}],"endpoint":{"url":"https://s3.{Region}.{partitionResult#dnsSuffix}","properties":{"authSchemes":[{"signingName":"s3","disableDoubleEncoding":true,"name":"sigv4","signingRegion":"{Region}"}]},"headers":{}},"type":"endpoint"}]}]}]},{"conditions":[],"error":"A valid partition could not be determined","type":"error"}]}]}]},{"conditions":[],"error":"Region must be set when path-style addressing is used","type":"error"}]}]}